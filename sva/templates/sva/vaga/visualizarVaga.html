{% extends 'sva/vaga/vaga.html' %}
{% load svatags %}

.divider{
    width:5px;
    height:auto;
    display:inline-block;
}

{% block content %}
    <div class="container-fluid">
        <div class="box box-primary">
            <div class="box-body box-profile">
                <p class="text-muted text-right" >Avaliação da vaga {{vaga.nota_media}}</p>
                <p><h3 class="profile-username text-center">{{ vaga.titulo }}</h3></p>
                {% if gerente.user|has_group:"Professor" %}
                    <p class="text-muted text-center"><b>Criada por</b> <a href="{% url 'Exibir_Professor' pk=gerente.user_id %}"><em>{{ gerente.user.first_name }} {{ gerente.user.last_name }}</em></a></p>
                {% elif gerente.user|has_group:"Empresa" %}
                    <p class="text-muted text-center"><b>Criada por</b> <a href="{% url 'Exibir_Empresa' pk=gerente.user_id %}"><em>{{ gerente.user.first_name }} {{ gerente.user.last_name }}</em></a></p>
                {% endif %}
                <p class="text-muted text-center">{{vaga.descricao}}</p>
                <hr>
                {% if vaga.data_validade is None %}
                    <p class="text-muted text-center"><b>Inscrições abertas</b></p>
                {% elif vaga.vencida %}
                    <p class="text-muted text-center"><b>Inscrições fechadas</b></p>
                {% else %}
                    <p class="text-muted text-center"><b>Inscrições abertas</b> até {{ vaga.data_validade}}</p>
                {% endif %}
                {% if request.user|has_group:"Professor" or request.user|has_group:"Empresa"  or request.user|has_group:"Gerente Vagas" %}
                <p class="text-center">
                    {% if vaga.alunos_inscritos.count == 1 %}
                        {{vaga.alunos_inscritos.count}} aluno inscrito
                    {% else %}
                        {{vaga.alunos_inscritos.count}} alunos inscritos
                    {% endif %}
                </p>
                {% endif %}
                <hr>
                <strong><i class="fa fa-graduation-cap margin-r-5"></i> Ofertada aos cursos de </strong>
                <p>
                    {% for curso in vaga.cursos.all %}
                        <span class="label label-primary">[{{curso.nome}} ({{curso.get_nivel_ensino_display}})]</span>&nbsp;
                    {% endfor %}
                </p>
                <strong><i class="fa fa-pencil margin-r-5"></i> Áreas de atuação </strong>
                <p>
                    {% for area in vaga.areas_atuacao.all %}
                        <span class="label label-success">[{{area.nome}}]</span>&nbsp;
                    {% endfor %}
                </p>
                {% if request.user|has_group:"Aluno" %}
                    <hr>
                    {% if vaga.situacao == 3 and vaga.data_validade is None or not vaga.vencida %}
                        <form action="" method="post">
                            {% csrf_token %}
                            <div class="text-center">
                                <div class="btn-group">
                                    {% if interessado == 1 %}
                                        <input type="submit" style="background-color: #ff6666; color: white;"  class="btn btn-default" name="uninterested" value="&#10006; Remover interesse"/>
                                    {% elif interessado == 0 %}
                                        <input type="submit" style="background-color: #3872B7; color: white;"  class="btn btn-default" name="interested" value="&#10025; Tenho interesse"/>
                                    {% elif interessado == 2 %}
                                        <input type="submit" style="background-color: #808080; color: white;"  class="btn btn-default" name="donothing" value="&#10025; Candidatado"/>
                                    {% endif %}
                                    &nbsp;
                                    {% if inscrito == 1 %}
                                        <input type="submit" style="background-color: #ff6666; color: white;"  class="btn btn-default" name="unsubscribe" value="&#10006; Remover candidatura"/>
                                    {% elif inscrito == 0 %}
                                        <input type="submit" style="background-color: #3872B7; color: white;"  class="btn btn-default" name="subscribe" value="&#10004; Candidatar-me"/>
                                    {% endif %}
                                </div>
                            </div>
                        </form>
                    {% endif %}
                {% endif %}

                {% if request.user.is_superuser or request.user|has_groups:"Administrador" or request.user|has_groups:"Setor de Estágios" %}
                    {% if not vaga.data_aprovacao and vaga.situacao == 2 or vaga.situacao == 1 %}
                    <hr>
                    <div class="text-center">
                        <button type="button" class="btn btn-danger" onClick="setar_valor_aprovado('false')" data-toggle="modal" data-target="#modal-default">
                            Indeferir o Cadastro
                        </button>
                        <button type="button" class="btn btn-primary"  onClick="setar_valor_aprovado('true')" data-toggle="modal" data-target="#modal-default">
                            Deferir Cadastro
                        </button>
                    </div>
                    {% endif %}
                    <div class="modal fade" id="modal-default" style="display: none; padding-right: 15px;">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                    <h4 class="modal-title">Confirmar Ação</h4>
                                </div>
                                <form method="post" action="{% url 'vaga_aprovar' vaga.id %}">
                                    {% csrf_token %}
                                    <div class="modal-body">
                                        {% block conteudo_modal %}
                                            <input type="hidden" name="aprovado" id="aprovado"/>
                                            <div class="form-group">
                                              <label class="control-label" for="justificativa">Justificativa</label>
                                              <textarea id="justificativa" name="justificativa" class="form-control"
                                                        rows="3" placeholder="Insira uma Justificativa"></textarea>
                                              <span class="help-block"></span>
                                            </div>
                                            <span>Por favor, insira uma justificativa ou uma mensagem de boas-vindas, que será enviada para o usuário </span>
                                        {% endblock %}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Fechar</button>
                                        <button type="submit" class="btn btn-primary">{% block label_botao %} Confirmar {% endblock %}</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <script>
                       function setar_valor_aprovado(valor) {
                           document.getElementById("aprovado").value = valor;
                       }
                    </script>
                {% endif %}
            </div>
        </div>
        <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title text-center">Informações básicas</h3>
            </div>
            <div class="box-body">
                <strong><i class="fa fa-map-marker margin-r-5"></i> Local </strong>
                <p>{{vaga.local}}</p>
                <strong><i class="fa fa-clock-o margin-r-5"></i> Carga horária semanal </strong>
                <p>{{vaga.carga_horaria_semanal}}</p>
                <strong><i class="fa fa-credit-card margin-r-5"></i> Valor da bolsa </strong>
                <p>R${{vaga.valor_bolsa|floatformat:2}}</p>


                <strong><i class="fa fa-handshake-o margin-r-5"></i> Benefícios concedidos </strong>
                <p>
                    {% if vaga.beneficios == '' %}
                        Nenhum
                    {% else %}
                        {{vaga.beneficios}}
                    {% endif %}
                </p>
                <div class="form-group col-lg-8 col-md-8 col-s-8 col-xs-12">
                    <label class="ratingLabel">Avaliação da vaga:</label>
                    <div class="rating">
                        <input id="star_c-5" name="rating_c" type="radio" value="5"/>
                        <label for="star_c-5" class="full"></label>
                        <input id="star_c-3" name="rating_c" type="radio" value="3"/>
                        <label for="star_c-3" class="full"></label>
                        <input id="star_c-2" name="rating_c" type="radio" value="2"/>
                        <label for="star_c-2" class="full"></label>
                        <input id="star_c-1" name="rating_c" type="radio" value="1"/>
                        <label for="star_c-1" class="full"></label>
                        <input id="star_c-0"  name="rating_c" type="radio" value="0"/>
                        <label for="star_c-0" class="full"></label>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
